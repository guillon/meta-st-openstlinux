From 8851b84fa2aed911a189be1ec5247aff76eb3c58 Mon Sep 17 00:00:00 2001
From: Christophe Priouzeau <christophe.priouzeau@linaro.org>
Date: Thu, 7 Apr 2016 10:21:39 +0200
Subject: [PATCH 08/24] STM: waylandsink: disable last-sample sink feature

The "last-sample" basesink feature stores a reference to the last buffer
sent for rendering. A consequence is that one buffer is always locked,
decreasing the number of buffers of the pool actually available.
Disabling this feature improves the buffer pool capacity and prevents
some deadlock race conditions.

Change-Id: I4249bfb38990f7fbc3a70ebf5005caedd831fd6d
Signed-off-by: Fabien Dessenne <fabien.dessenne@st.com>
Reviewed-on: https://gerrit.st.com/44589
Reviewed-by: Vincent ABRIOU <vincent.abriou@st.com>
Reviewed-by: Benjamin GAIGNARD <benjamin.gaignard@st.com>
---
 ext/wayland/gstwaylandsink.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/ext/wayland/gstwaylandsink.c b/ext/wayland/gstwaylandsink.c
index f4f34a8..ddb3701 100644
--- a/ext/wayland/gstwaylandsink.c
+++ b/ext/wayland/gstwaylandsink.c
@@ -163,6 +163,10 @@ gst_wayland_sink_class_init (GstWaylandSinkClass * klass)
 static void
 gst_wayland_sink_init (GstWaylandSink * sink)
 {
+  GstBaseSink *basesink = GST_BASE_SINK_CAST (GST_VIDEO_SINK_CAST (sink));
+
+  gst_base_sink_set_last_sample_enabled (basesink, FALSE);
+
   g_mutex_init (&sink->display_lock);
   g_mutex_init (&sink->render_lock);
 }
-- 
2.7.4

