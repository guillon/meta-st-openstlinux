From 4187da2c7adca5ad1904d7b2181a7fd2ddc1a517 Mon Sep 17 00:00:00 2001
From: Christophe Priouzeau <christophe.priouzeau@st.com>
Date: Mon, 20 Feb 2017 13:55:27 +0100
Subject: [PATCH] Usage of LDLAGS

---
 flags.mk                | 8 ++++----
 libteec/Makefile        | 2 +-
 tee-supplicant/Makefile | 2 +-
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/flags.mk b/flags.mk
index 71f3d18..04b0c88 100644
--- a/flags.mk
+++ b/flags.mk
@@ -2,11 +2,11 @@
 # COMMON COMPILATION FLAGS                                              #
 #########################################################################
 
-CROSS_COMPILE   ?= arm-linux-gnueabihf-
-CC              ?= $(CROSS_COMPILE)gcc
-AR		?= $(CROSS_COMPILE)ar
+# CROSS_COMPILE   ?= arm-linux-gnueabihf-
+# CC              ?= $(CROSS_COMPILE)gcc
+# AR		?= $(CROSS_COMPILE)ar
 
-CFLAGS          := -Wall -Wbad-function-cast -Wcast-align \
+CFLAGS          += -Wall -Wbad-function-cast -Wcast-align \
 		   -Werror-implicit-function-declaration -Wextra \
 		   -Wfloat-equal -Wformat-nonliteral -Wformat-security \
 		   -Wformat=2 -Winit-self -Wmissing-declarations \
diff --git a/libteec/Makefile b/libteec/Makefile
index 66055a7..f75c55d 100644
--- a/libteec/Makefile
+++ b/libteec/Makefile
@@ -29,7 +29,7 @@ TEEC_CFLAGS	:= $(addprefix -I, $(TEEC_INCLUDES)) $(CFLAGS) -D_GNU_SOURCE \
 		   -DDEBUGLEVEL_$(CFG_TEE_CLIENT_LOG_LEVEL) \
 		   -DBINARY_PREFIX=\"TEEC\"
 
-TEEC_LFLAGS    := -lpthread
+TEEC_LFLAGS    := -lpthread $(LDFLAGS)
 TEEC_LIBRARY	:= $(OUT_DIR)/$(LIB_MAJ_MIN)
 
 libteec: $(TEEC_LIBRARY)
diff --git a/tee-supplicant/Makefile b/tee-supplicant/Makefile
index af4024d..bfb6aec 100644
--- a/tee-supplicant/Makefile
+++ b/tee-supplicant/Makefile
@@ -46,7 +46,7 @@ ifeq ($(CFG_TA_TEST_PATH),1)
 TEES_CFLAGS	+= -DCFG_TA_TEST_PATH=1
 endif
 TEES_FILE	:= $(OUT_DIR)/$(PACKAGE_NAME)
-TEES_LDFLAGS    := -L$(OUT_DIR)/../libteec -lteec
+TEES_LDFLAGS    := -L$(OUT_DIR)/../libteec -lteec $(LDFLAGS)
 
 ifeq ($(CFG_SQL_FS),y)
 TEES_CFLAGS	+= -DCFG_SQL_FS
-- 
2.7.4

