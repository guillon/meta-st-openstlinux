From da2130c4fce62ce9c97b0712354c29039311e96c Mon Sep 17 00:00:00 2001
From: Vincent Abriou <vincent.abriou@st.com>
Date: Wed, 10 Aug 2016 15:25:29 +0200
Subject: [PATCH 56/61] gl-renderer: force BT709 full range for NV12 dmabuf
 buffer

This fix the color issue seen during transition from HW composition
to egl composition.

Proper implementation should be implemented in the wayland-linux-dmabuf
protocol.

Change-Id: I2ed43d9966ee7f6e2d990521534391a2447411c9
Signed-off-by: Vincent Abriou <vincent.abriou@st.com>
---
 libweston/gl-renderer.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/libweston/gl-renderer.c b/libweston/gl-renderer.c
index 1be7c83..1525df8 100644
--- a/libweston/gl-renderer.c
+++ b/libweston/gl-renderer.c
@@ -1599,6 +1599,14 @@ import_simple_dmabuf(struct gl_renderer *gr,
 		attribs[atti++] = attributes->stride[2];
 	}
 
+	if (attributes->format == DRM_FORMAT_NV12) {
+		/* default color space and range is BT709 full range */
+		attribs[atti++] = EGL_YUV_COLOR_SPACE_HINT_EXT;
+		attribs[atti++] = EGL_ITU_REC709_EXT;
+		attribs[atti++] = EGL_SAMPLE_RANGE_HINT_EXT;
+		attribs[atti++] = EGL_YUV_FULL_RANGE_EXT;
+	}
+
 	attribs[atti++] = EGL_NONE;
 
 	image = egl_image_create(gr, EGL_LINUX_DMA_BUF_EXT, NULL,
-- 
2.7.4

