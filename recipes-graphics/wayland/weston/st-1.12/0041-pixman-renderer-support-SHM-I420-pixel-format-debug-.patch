From 4355a40c4103a7b4970d9623153d3329823c07a4 Mon Sep 17 00:00:00 2001
From: Vincent Abriou <vincent.abriou@st.com>
Date: Wed, 3 Aug 2016 15:43:59 +0200
Subject: [PATCH 41/61] pixman-renderer: support SHM I420 pixel format (debug
 purpose)

Pixman library only support YVU420 pixel format whereas I420 is equivalent
to YUV420.
Consequence is that I420 color will be wrong due to U and V planes
inversion in pixman pixel treatment but it will be sufficient for test
and debug purpose.

Change-Id: I69d2ad2b5d6609c0d794d1257d3434cd3562bd63
Signed-off-by: Vincent Abriou <vincent.abriou@st.com>
---
 libweston/pixman-renderer.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/libweston/pixman-renderer.c b/libweston/pixman-renderer.c
index d84104e..ee391dd 100644
--- a/libweston/pixman-renderer.c
+++ b/libweston/pixman-renderer.c
@@ -654,6 +654,10 @@ pixman_renderer_attach(struct weston_surface *es, struct weston_buffer *buffer)
 		case WL_SHM_FORMAT_NV12:
 			pixman_format = PIXMAN_nv12;
 			break;
+		case WL_SHM_FORMAT_YUV420:
+			pixman_format = PIXMAN_yv12;
+			weston_log("Warning: YUV420 will be treated as YVU420 by pixman. Color will be wrong!\n");
+			break;
 		default:
 			weston_log("Unsupported SHM buffer format\n");
 			weston_buffer_reference(&ps->buffer_ref, NULL);
@@ -1021,6 +1025,7 @@ pixman_renderer_init(struct weston_compositor *ec)
 	wl_display_add_shm_format(ec->wl_display, WL_SHM_FORMAT_BGR888);
 	wl_display_add_shm_format(ec->wl_display, WL_SHM_FORMAT_RGB565);
 	wl_display_add_shm_format(ec->wl_display, WL_SHM_FORMAT_NV12);
+	wl_display_add_shm_format(ec->wl_display, WL_SHM_FORMAT_YUV420);
 
 	wl_signal_init(&renderer->destroy_signal);
 
-- 
2.7.4

